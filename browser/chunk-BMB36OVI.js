import{N as h,a as c,b as d,j as n,q as m}from"./chunk-HQDDE6HI.js";var b=class g{STORAGE_KEY="bolddesk_tickets";MESSAGE_STORAGE_KEY="bolddesk_messages";ticketsSubject=new n([]);countsSubject=new n(this.getInitialCounts());tickets$=this.ticketsSubject.asObservable();counts$=this.countsSubject.asObservable();constructor(){this.loadTicketsFromStorage()}getInitialCounts(){return{pending:0,open:0,resolved:0,closed:0,onHold:0,resolutionDue:0,responseDue:0,created:0,requested:0,total:0}}loadTicketsFromStorage(){try{let t=localStorage.getItem(this.STORAGE_KEY);if(t){let i=JSON.parse(t).map(s=>d(c({},s),{createdAt:new Date(s.createdAt),updatedAt:new Date(s.updatedAt),resolutionDue:s.resolutionDue?new Date(s.resolutionDue):void 0,messages:s.messages?.map(e=>d(c({},e),{createdAt:new Date(e.createdAt)}))||[]}));this.ticketsSubject.next(i),this.updateCounts(i)}else this.initializeSampleData()}catch(t){console.error("Error loading tickets from storage:",t),this.initializeSampleData()}}saveTicketsToStorage(t){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(i){console.error("Error saving tickets to storage:",i)}}updateCounts(t){let i=new Date,s={pending:t.filter(e=>e.status==="Pending").length,open:t.filter(e=>e.status==="Open").length,resolved:t.filter(e=>e.status==="Resolved").length,closed:t.filter(e=>e.status==="Closed").length,onHold:t.filter(e=>e.status==="On Hold").length,resolutionDue:t.filter(e=>e.resolutionDue&&e.resolutionDue<i&&e.status!=="Resolved"&&e.status!=="Closed").length,responseDue:t.filter(e=>{let a=e.messages[e.messages.length-1];return a?(i.getTime()-a.createdAt.getTime())/(1e3*3600)>24&&a.author.type==="customer"&&e.status!=="Resolved"&&e.status!=="Closed":!1}).length,created:t.length,requested:t.length,total:t.length};this.countsSubject.next(s)}initializeSampleData(){let t=[{id:"1",title:"Unable to access dashboard after login",description:"I am experiencing issues accessing the main dashboard after successful login. The page keeps loading indefinitely.",status:"Open",priority:"High",type:"Bug",category:"Technical",tags:["login","dashboard","access"],requester:{id:"user1",name:"John Smith",email:"john.smith@example.com",initials:"JS",contactGroup:"Premium Support",timeZone:"Eastern Standard Time"},assignee:{id:"agent1",name:"Likitha"},watchers:[],visibility:"Public",createdAt:new Date(Date.now()-1728e5),updatedAt:new Date(Date.now()-864e5),resolutionDue:new Date(Date.now()+864e5),messages:[{id:"msg1",ticketId:"1",author:{id:"user1",name:"John Smith",initials:"JS",type:"customer"},content:"I am experiencing issues accessing the main dashboard after successful login. The page keeps loading indefinitely.",createdAt:new Date(Date.now()-1728e5),isInternal:!1}],isPrivate:!1},{id:"2",title:"Password reset email not received",description:"I requested a password reset but haven't received the email yet. Please help.",status:"Pending",priority:"Normal",type:"Request",category:"Account",tags:["password","email","reset"],requester:{id:"user2",name:"Sarah Johnson",email:"sarah.johnson@example.com",initials:"SJ"},assignee:{id:"agent1",name:"Likitha"},watchers:[],visibility:"Public",createdAt:new Date(Date.now()-864e5),updatedAt:new Date(Date.now()-864e5),messages:[{id:"msg2",ticketId:"2",author:{id:"user2",name:"Sarah Johnson",initials:"SJ",type:"customer"},content:"I requested a password reset but haven't received the email yet. Please help.",createdAt:new Date(Date.now()-864e5),isInternal:!1}],isPrivate:!1},{id:"3",title:"Feature request: Dark mode support",description:"Would love to see dark mode support in the application for better user experience.",status:"Open",priority:"Low",type:"Feature Request",category:"Enhancement",tags:["dark-mode","ui","feature"],requester:{id:"user3",name:"Mike Davis",email:"mike.davis@example.com",initials:"MD"},assignee:{id:"agent1",name:"Likitha"},watchers:[],visibility:"Public",createdAt:new Date(Date.now()-2592e5),updatedAt:new Date(Date.now()-2592e5),messages:[{id:"msg3",ticketId:"3",author:{id:"user3",name:"Mike Davis",initials:"MD",type:"customer"},content:"Would love to see dark mode support in the application for better user experience.",createdAt:new Date(Date.now()-2592e5),isInternal:!1}],isPrivate:!1},{id:"4",title:"Sample Ticket: How to Solve a Ticket in Bold Desk?",description:"This is a sample ticket to demonstrate the ticket management system functionality.",status:"On Hold",priority:"Normal",type:"Question",category:"General",tags:["sample","demo"],requester:{id:"user4",name:"Demo User",email:"demo@example.com",initials:"DU"},assignee:{id:"agent1",name:"Likitha"},watchers:[],visibility:"Public",createdAt:new Date(Date.now()-864e5),updatedAt:new Date(Date.now()-864e5),messages:[{id:"msg4",ticketId:"4",author:{id:"user4",name:"Demo User",initials:"DU",type:"customer"},content:"This is a sample ticket to demonstrate the ticket management system functionality.",createdAt:new Date(Date.now()-864e5),isInternal:!1}],isPrivate:!1}];this.ticketsSubject.next(t),this.saveTicketsToStorage(t),this.updateCounts(t)}getTickets(){return this.tickets$}getCounts(){return this.counts$}getTicketById(t){return this.tickets$.pipe(m(i=>i.find(s=>s.id===t)))}createTicket(t){let i=d(c({},t),{id:this.generateId(),createdAt:new Date,updatedAt:new Date,messages:[{id:this.generateId(),ticketId:"",author:{id:t.requester.id,name:t.requester.name,initials:t.requester.initials,type:"customer"},content:t.description,createdAt:new Date,isInternal:!1}]});i.messages[0].ticketId=i.id;let s=this.ticketsSubject.value,e=[i,...s];return this.ticketsSubject.next(e),this.saveTicketsToStorage(e),this.updateCounts(e),new n(i).asObservable()}updateTicket(t,i){let s=this.ticketsSubject.value,e=s.findIndex(r=>r.id===t);if(e===-1)return new n(null).asObservable();let a=d(c(c({},s[e]),i),{updatedAt:new Date}),o=[...s];return o[e]=a,this.ticketsSubject.next(o),this.saveTicketsToStorage(o),this.updateCounts(o),new n(a).asObservable()}addMessageToTicket(t,i,s,e,a,o=!1){let r=this.ticketsSubject.value,u=r.findIndex(k=>k.id===t);if(u===-1)return new n(null).asObservable();let p={id:this.generateId(),ticketId:t,author:{id:s,name:e,initials:a,type:"agent"},content:i,createdAt:new Date,isInternal:o},T=d(c({},r[u]),{messages:[...r[u].messages,p],updatedAt:new Date,status:r[u].status==="Pending"?"Open":r[u].status}),l=[...r];return l[u]=T,this.ticketsSubject.next(l),this.saveTicketsToStorage(l),this.updateCounts(l),new n(p).asObservable()}deleteTicket(t){let s=this.ticketsSubject.value.filter(e=>e.id!==t);return this.ticketsSubject.next(s),this.saveTicketsToStorage(s),this.updateCounts(s),new n(!0).asObservable()}searchTickets(t){return this.tickets$.pipe(m(i=>{if(!t.trim())return i;let s=t.toLowerCase();return i.filter(e=>e.title.toLowerCase().includes(s)||e.description.toLowerCase().includes(s)||e.requester.name.toLowerCase().includes(s)||e.requester.email.toLowerCase().includes(s)||e.id.toLowerCase().includes(s))}))}sortTickets(t,i){switch(i){case"Created - Desc":return[...t].sort((e,a)=>a.createdAt.getTime()-e.createdAt.getTime());case"Modified - Desc":return[...t].sort((e,a)=>a.updatedAt.getTime()-e.updatedAt.getTime());case"Priority - High to Low":let s={Urgent:4,High:3,Normal:2,Low:1};return[...t].sort((e,a)=>s[a.priority]-s[e.priority]);case"Status - A to Z":return[...t].sort((e,a)=>e.status.localeCompare(a.status));default:return t}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static \u0275fac=function(i){return new(i||g)};static \u0275prov=h({token:g,factory:g.\u0275fac,providedIn:"root"})};export{b as a};
